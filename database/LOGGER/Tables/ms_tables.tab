prompt $Id: ms_tables.sql 810 2008-05-29 00:07:59Z Demo $

CREATE TABLE MS_PROCESS
(
   PROCESS_ID     NUMBER                          NOT NULL
  ,EXT_REF        VARCHAR2(30)
  ,ORIGIN         VARCHAR2(100)
  ,USERNAME       VARCHAR2(30)
  ,CREATED_DATE   DATE
  ,COMMENTS       VARCHAR2(1000)
  ,internal_error VARCHAR2(1) default 'N'
  ,notified_flag  VARCHAR2(1) default 'N'
)
LOGGING
NOCACHE
NOPARALLEL
/

CREATE TABLE MS_UNIT
( UNIT_ID           NUMBER,
  UNIT_NAME         VARCHAR2(50),
  UNIT_TYPE         VARCHAR2(10),
  MODULE_ID         NUMBER,
  MSG_MODE          NUMBER,
  OPEN_PROCESS      VARCHAR2(1)  default 'N'
)
LOGGING
NOCACHE
NOPARALLEL
/
CREATE TABLE MS_MODULE
(
  MODULE_ID         NUMBER,
  MODULE_NAME       VARCHAR2(50),
  REVISION          VARCHAR2(30),
  MODULE_TYPE       VARCHAR2(10),
  MSG_MODE          NUMBER,
  OPEN_PROCESS      VARCHAR2(1)  default 'N'
)
LOGGING
NOCACHE
NOPARALLEL
/



CREATE TABLE MS_TRAVERSAL
(
  TRAVERSAL_ID         NUMBER                   NOT NULL,
  PROCESS_ID           NUMBER                   NOT NULL,
  UNIT_ID              NUMBER                   NOT NULL,
  PARENT_TRAVERSAL_ID  NUMBER,
  MSG_MODE             NUMBER
)
LOGGING
NOCACHE
NOPARALLEL
/

CREATE TABLE MS_REFERENCE
( MESSAGE_ID        NUMBER    NOT NULL
 ,TRAVERSAL_ID      NUMBER    NOT NULL
 ,NAME              VARCHAR2(30)    --variable name
 ,VALUE             VARCHAR2(100)   --value, code or id
 ,DESCR             VARCHAR2(100)   --description of code or id
 ,PARAM_IND         VARCHAR2(1)  default 'N'   --Y/N is this a parameter a UNIT
)
LOGGING
NOCACHE
NOPARALLEL
/

CREATE TABLE MS_MESSAGE
(
  MESSAGE_ID    NUMBER                          NOT NULL,
  TRAVERSAL_ID  NUMBER                          NOT NULL,
  MESSAGE       VARCHAR2(200),
  MSG_LEVEL     NUMBER(1),
  TIME_NOW      DATE
)
LOGGING
NOCACHE
NOPARALLEL
/

CREATE TABLE MS_LARGE_MESSAGE
(
  MESSAGE_ID    NUMBER   NOT NULL,
  TRAVERSAL_ID  NUMBER   NOT NULL,
  MESSAGE       VARCHAR2(4000),
  MSG_LEVEL     NUMBER(1),
  TIME_NOW      DATE
)
LOGGING
NOCACHE
NOPARALLEL
/

CREATE TABLE MS_INTERNAL_ERROR
(  
  MESSAGE_ID    NUMBER     NOT NULL,
  TRAVERSAL_ID  NUMBER     NOT NULL,
  PROCESS_ID    NUMBER,
  MESSAGE       VARCHAR2(200),
  MSG_LEVEL     NUMBER(1),
  TIME_NOW      DATE
)
LOGGING
NOCACHE
NOPARALLEL
/


/*
CREATE TABLE MS_PROFILE
(
  PROFILE_ID        NUMBER,
  PROFILE_NAME      VARCHAR2(50),
  MSG_MODE          NUMBER,
  OPEN_PROCESS      VARCHAR2(1)
)
TABLESPACE MS_DATA
LOGGING
NOCACHE
NOPARALLEL
/

CREATE TABLE MS_PROFILE_MODULE
(
  PROFILE_ID        NUMBER,
  MODULE_NAME       VARCHAR2(50),
  MSG_MODE          NUMBER,
  OPEN_PROCESS      VARCHAR2(1)
)
TABLESPACE MS_DATA
LOGGING
NOCACHE
NOPARALLEL
/


CREATE TABLE MS_PROFILE_MOD_UNIT ??
(
  PROFILE_ID        NUMBER,
  MODULE_NAME       VARCHAR2(50),
  MSG_MODE          NUMBER,
  OPEN_PROCESS      VARCHAR2(1)
)
TABLESPACE MS_DATA
LOGGING
NOCACHE
NOPARALLEL
/
*/



CREATE INDEX MESSAGE_NK1 ON MS_MESSAGE
(TRAVERSAL_ID)
LOGGING
NOPARALLEL
/


CREATE UNIQUE INDEX MESSAGE_PK ON MS_MESSAGE
(MESSAGE_ID)
LOGGING
NOPARALLEL
/

CREATE UNIQUE INDEX MODULE_PK ON MS_MODULE
(MODULE_ID)
LOGGING
NOPARALLEL
/

CREATE UNIQUE INDEX UNIT_PK ON MS_UNIT
(UNIT_ID)
LOGGING
NOPARALLEL
/

CREATE UNIQUE INDEX UNIT_UK ON MS_UNIT
(MODULE_ID, UNIT_NAME)
LOGGING
NOPARALLEL
/


CREATE INDEX REFERENCE_NK1 ON MS_REFERENCE
(TRAVERSAL_ID)
LOGGING
NOPARALLEL
/

CREATE UNIQUE INDEX REFERENCE_PK ON MS_REFERENCE
(MESSAGE_ID)
LOGGING
NOPARALLEL
/


CREATE UNIQUE INDEX PROCESS_PK ON MS_PROCESS
(PROCESS_ID)
LOGGING
NOPARALLEL
/


CREATE INDEX TRAVERSAL_NK1 ON MS_TRAVERSAL
(PROCESS_ID)
LOGGING
NOPARALLEL
/


CREATE INDEX TRAVERSAL_NK2 ON MS_TRAVERSAL
(UNIT_ID)
LOGGING
NOPARALLEL
/


CREATE INDEX TRAVERSAL_NK3 ON MS_TRAVERSAL
(PARENT_TRAVERSAL_ID)
LOGGING
NOPARALLEL
/


CREATE UNIQUE INDEX TRAVERSAL_PK ON MS_TRAVERSAL
(TRAVERSAL_ID)
LOGGING
NOPARALLEL
/


ALTER TABLE MS_MESSAGE ADD (
  CONSTRAINT MESSAGE_PK PRIMARY KEY (MESSAGE_ID)
)
/


ALTER TABLE MS_UNIT ADD (
  CONSTRAINT UNIT_PK PRIMARY KEY (UNIT_ID)
)
/

ALTER TABLE MS_MODULE ADD (
  CONSTRAINT MODULE_PK PRIMARY KEY (MODULE_ID)
)
/


ALTER TABLE MS_PROCESS ADD (
  CONSTRAINT PROCESS_PK PRIMARY KEY (PROCESS_ID)
)
/


ALTER TABLE MS_TRAVERSAL ADD (
  CONSTRAINT TRAVERSAL_PK PRIMARY KEY (TRAVERSAL_ID))
/

ALTER TABLE MS_UNIT ADD (
  CONSTRAINT UNIT_MOD_FK FOREIGN KEY (MODULE_ID)
    REFERENCES MS_MODULE (MODULE_ID)
    ON DELETE CASCADE)
/

ALTER TABLE MS_MESSAGE ADD (
  CONSTRAINT MESS_TRAV_FK FOREIGN KEY (TRAVERSAL_ID)
    REFERENCES MS_TRAVERSAL (TRAVERSAL_ID)
    ON DELETE CASCADE)
/

ALTER TABLE MS_LARGE_MESSAGE ADD (
  CONSTRAINT LRG_MESS_TRAV_FK FOREIGN KEY (TRAVERSAL_ID)
    REFERENCES MS_TRAVERSAL (TRAVERSAL_ID)
    ON DELETE CASCADE)
/

CREATE UNIQUE INDEX LARGE_MESSAGE_PK ON MS_LARGE_MESSAGE
(MESSAGE_ID)
LOGGING
NOPARALLEL
/


--ALTER TABLE MS_INTERNAL_ERROR ADD (
--  CONSTRAINT INT_ERR_TRAV_FK FOREIGN KEY (TRAVERSAL_ID)
--    REFERENCES MS_TRAVERSAL (TRAVERSAL_ID)
--    ON DELETE CASCADE)
--/

ALTER TABLE MS_REFERENCE ADD (
  CONSTRAINT REF_TRAV_FK FOREIGN KEY (TRAVERSAL_ID)
    REFERENCES MS_TRAVERSAL (TRAVERSAL_ID)
    ON DELETE CASCADE)
/


ALTER TABLE MS_TRAVERSAL ADD (
  CONSTRAINT TRAV_UNIT_FK FOREIGN KEY (UNIT_ID)
    REFERENCES MS_UNIT (UNIT_ID))
/

ALTER TABLE MS_TRAVERSAL ADD (
  CONSTRAINT TRAV_TRAV_FK FOREIGN KEY (PARENT_TRAVERSAL_ID)
    REFERENCES MS_TRAVERSAL (TRAVERSAL_ID))
/

ALTER TABLE MS_TRAVERSAL ADD (
  CONSTRAINT TRAV_PROCESS_FK FOREIGN KEY (PROCESS_ID)
    REFERENCES MS_PROCESS (PROCESS_ID)
    ON DELETE CASCADE)
/

ALTER TABLE MS_UNIT ADD
 CHECK (msg_mode in (1,2,4)) ENABLE
 VALIDATE
/

 ALTER TABLE MS_MODULE ADD
  CHECK (msg_mode in (1,2,4)) ENABLE
 VALIDATE
/

ALTER TABLE MS_UNIT ADD
 CHECK (open_process in ('Y','C','N')) ENABLE
 VALIDATE
/

 ALTER TABLE MS_MODULE ADD
  CHECK (open_process in ('Y','C','N')) ENABLE
 VALIDATE
/


