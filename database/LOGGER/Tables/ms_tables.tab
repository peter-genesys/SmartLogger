prompt $Id: ms_tables.sql 810 2008-05-29 00:07:59Z Demo $

DROP TABLE MS_MESSAGE;
DROP TABLE MS_TRAVERSAL;
DROP TABLE MS_UNIT;
DROP TABLE MS_MODULE;
DROP TABLE MS_PROCESS;


CREATE TABLE MS_PROCESS
(
   PROCESS_ID     NUMBER                          NOT NULL
  ,ORIGIN         VARCHAR2(100)  ,USERNAME       VARCHAR2(30)
  ,internal_error VARCHAR2(1) default 'N'
  ,notified_flag  VARCHAR2(1) default 'N'
  ,error_message  CLOB
  ,CREATED_DATE   DATE
  ,UPDATED_DATE   DATE
  ,keep_yn varchar2(1) default 'N'
)
LOGGING
NOCACHE
NOPARALLEL
/

CREATE TABLE MS_UNIT
( UNIT_ID           NUMBER,
  UNIT_NAME         VARCHAR2(50),
  UNIT_TYPE         VARCHAR2(10),
  MODULE_ID         NUMBER,
  AUTO_WAKE         VARCHAR2(1)  default 'N',
  AUTO_MSG_MODE     NUMBER,
  MANUAL_MSG_MODE   NUMBER
)
LOGGING
NOCACHE
NOPARALLEL
/
CREATE TABLE MS_MODULE
(
  MODULE_ID         NUMBER,
  MODULE_NAME       VARCHAR2(50),
  REVISION          VARCHAR2(30),
  MODULE_TYPE       VARCHAR2(30),
  AUTO_WAKE         VARCHAR2(1)  default 'N',
  AUTO_MSG_MODE     NUMBER,
  MANUAL_MSG_MODE   NUMBER
)
LOGGING
NOCACHE
NOPARALLEL
/

alter table ms_module add owner varchar2(30);


CREATE TABLE MS_TRAVERSAL
(
  TRAVERSAL_ID         NUMBER                   NOT NULL,
  PROCESS_ID           NUMBER                   NOT NULL,
  UNIT_ID              NUMBER                   NOT NULL,
  PARENT_TRAVERSAL_ID  NUMBER,
  MSG_MODE             NUMBER
)
LOGGING
NOCACHE
NOPARALLEL
/


CREATE TABLE MS_MESSAGE
(
  MESSAGE_ID    NUMBER                          NOT NULL
 ,TRAVERSAL_ID  NUMBER                          NOT NULL
 ,NAME          VARCHAR2(100)                   --variable name
 ,VALUE         VARCHAR2(30)                    --variable value
 ,MESSAGE       CLOB
 ,MSG_TYPE      VARCHAR2(10)                    --MESSAGE, PARAM, NOTE
 ,MSG_LEVEL     INTEGER
 ,TIME_NOW      TIMESTAMP(9)
)
LOGGING
NOCACHE
NOPARALLEL
/




/*
CREATE TABLE MS_PROFILE
(
  PROFILE_ID        NUMBER,
  PROFILE_NAME      VARCHAR2(50),
  MSG_MODE          NUMBER,
  OPEN_PROCESS      VARCHAR2(1)
)
TABLESPACE MS_DATA
LOGGING
NOCACHE
NOPARALLEL
/

CREATE TABLE MS_PROFILE_MODULE
(
  PROFILE_ID        NUMBER,
  MODULE_NAME       VARCHAR2(50),
  MSG_MODE          NUMBER,
  OPEN_PROCESS      VARCHAR2(1)
)
TABLESPACE MS_DATA
LOGGING
NOCACHE
NOPARALLEL
/


CREATE TABLE MS_PROFILE_MOD_UNIT ??
(
  PROFILE_ID        NUMBER,
  MODULE_NAME       VARCHAR2(50),
  MSG_MODE          NUMBER,
  OPEN_PROCESS      VARCHAR2(1)
)
TABLESPACE MS_DATA
LOGGING
NOCACHE
NOPARALLEL
/
*/



CREATE INDEX MESSAGE_NK1 ON MS_MESSAGE
(TRAVERSAL_ID)
LOGGING
NOPARALLEL
/


CREATE UNIQUE INDEX MESSAGE_PK ON MS_MESSAGE
(MESSAGE_ID)
LOGGING
NOPARALLEL
/

CREATE UNIQUE INDEX MODULE_PK ON MS_MODULE
(MODULE_ID)
LOGGING
NOPARALLEL
/

CREATE UNIQUE INDEX UNIT_PK ON MS_UNIT
(UNIT_ID)
LOGGING
NOPARALLEL
/

CREATE UNIQUE INDEX UNIT_UK ON MS_UNIT
(MODULE_ID, UNIT_NAME)
LOGGING
NOPARALLEL
/



CREATE UNIQUE INDEX PROCESS_PK ON MS_PROCESS
(PROCESS_ID)
LOGGING
NOPARALLEL
/


CREATE INDEX TRAVERSAL_NK1 ON MS_TRAVERSAL
(PROCESS_ID)
LOGGING
NOPARALLEL
/


CREATE INDEX TRAVERSAL_NK2 ON MS_TRAVERSAL
(UNIT_ID)
LOGGING
NOPARALLEL
/


CREATE INDEX TRAVERSAL_NK3 ON MS_TRAVERSAL
(PARENT_TRAVERSAL_ID)
LOGGING
NOPARALLEL
/


CREATE UNIQUE INDEX TRAVERSAL_PK ON MS_TRAVERSAL
(TRAVERSAL_ID)
LOGGING
NOPARALLEL
/


ALTER TABLE MS_MESSAGE ADD (
  CONSTRAINT MESSAGE_PK PRIMARY KEY (MESSAGE_ID)
)
/


ALTER TABLE MS_UNIT ADD (
  CONSTRAINT UNIT_PK PRIMARY KEY (UNIT_ID)
)
/

ALTER TABLE MS_MODULE ADD (
  CONSTRAINT MODULE_PK PRIMARY KEY (MODULE_ID)
)
/


ALTER TABLE MS_PROCESS ADD (
  CONSTRAINT PROCESS_PK PRIMARY KEY (PROCESS_ID)
)
/


ALTER TABLE MS_TRAVERSAL ADD (
  CONSTRAINT TRAVERSAL_PK PRIMARY KEY (TRAVERSAL_ID))
/

ALTER TABLE MS_UNIT ADD (
  CONSTRAINT UNIT_MOD_FK FOREIGN KEY (MODULE_ID)
    REFERENCES MS_MODULE (MODULE_ID)
    ON DELETE CASCADE)
/

ALTER TABLE MS_MESSAGE ADD (
  CONSTRAINT MESS_TRAV_FK FOREIGN KEY (TRAVERSAL_ID)
    REFERENCES MS_TRAVERSAL (TRAVERSAL_ID)
    ON DELETE CASCADE)
/




ALTER TABLE MS_TRAVERSAL ADD (
  CONSTRAINT TRAV_UNIT_FK FOREIGN KEY (UNIT_ID)
    REFERENCES MS_UNIT (UNIT_ID))
/

ALTER TABLE MS_TRAVERSAL ADD (
  CONSTRAINT TRAV_TRAV_FK FOREIGN KEY (PARENT_TRAVERSAL_ID)
    REFERENCES MS_TRAVERSAL (TRAVERSAL_ID))
/

ALTER TABLE MS_TRAVERSAL ADD (
  CONSTRAINT TRAV_PROCESS_FK FOREIGN KEY (PROCESS_ID)
    REFERENCES MS_PROCESS (PROCESS_ID)
    ON DELETE CASCADE)
/

ALTER TABLE MS_UNIT ADD
 CHECK (AUTO_MSG_MODE in (1,2,4,99)) ENABLE
 VALIDATE
/

 ALTER TABLE MS_MODULE ADD
  CHECK (AUTO_MSG_MODE in (1,2,4,99)) ENABLE
 VALIDATE
/

ALTER TABLE MS_UNIT ADD
 CHECK (MANUAL_MSG_MODE in (1,2,4,99)) ENABLE
 VALIDATE
/

 ALTER TABLE MS_MODULE ADD
  CHECK (MANUAL_MSG_MODE in (1,2,4,99)) ENABLE
 VALIDATE
/

ALTER TABLE MS_UNIT ADD
 CHECK (AUTO_WAKE in ('F','Y','N')) ENABLE
 VALIDATE
/

 ALTER TABLE MS_MODULE ADD
  CHECK (AUTO_WAKE in ('F','Y','N')) ENABLE
 VALIDATE
/


