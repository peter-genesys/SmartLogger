BEGAN: log_process                                                              
.i_origin  :SQL SCRIPT aop_test.sql                                             
.i_ext_ref :1                                                                   
.i_comments:Testing the results of the aop_processor package                    
.g_process_id:5                                                                 
ENDED: log_process                                                              
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :anon                                                             
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :anon                                                             
.i_unit_type  :SCRIPT                                                           
.i_create  :TRUE                                                                
!Create a new unit                                                              
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:anon                                                    
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:anon                                                     
.current call_stack_level:8                                                     
.f_index:0                                                                      
.g_nodes(f_index).unit.unit_name:                                               
ENDED: pop_to_parent_node                                                       
BEGAN: push_node                                                                
.io_node.unit.unit_name:anon                                                    
.l_next_index:1                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :                                                                 
.i_create  :FALSE                                                               
ENDED: find_module                                                              
BEGAN: set_module_msg_mode                                                      
.i_module_id:2                                                                  
.i_msg_mode:1                                                                   
ENDED: set_module_msg_mode                                                      
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test1                                                            
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test1                                                            
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
!Create a new unit                                                              
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test1                                                   
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test1                                                    
.current call_stack_level:9                                                     
.f_index:1                                                                      
.g_nodes(f_index).unit.unit_name:anon                                           
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :1                                                           
.i_msg_mode        :4                                                           
BEGAN: dump_nodes                                                               
.i_index           :0                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :anon                                                       
.i_parent_index     :0                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :anon                                                       
.traversal_id       :381                                                        
.unit_id            :41                                                         
.parent_traversal_id:                                                           
.process_id         :5                                                          
.msg_mode           :4                                                          
ENDED: log_node                                                                 
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test1                                                      
.i_parent_index     :1                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test1                                                      
.traversal_id       :382                                                        
.unit_id            :42                                                         
.parent_traversal_id:381                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test1                                                   
.l_next_index:2                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test3                                                            
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test3                                                            
.i_unit_type  :FUNC                                                             
.i_create  :TRUE                                                                
!Create a new unit                                                              
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test3                                                   
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test1                                          
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :2                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test3                                                      
.i_parent_index     :2                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test3                                                      
.traversal_id       :383                                                        
.unit_id            :43                                                         
.parent_traversal_id:382                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test3                                                   
.l_next_index:3                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22500                                                             
.traversal_id:383                                                               
.name        :i_param31                                                         
.value       :X                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.189600000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22502                                                             
.traversal_id:383                                                               
.name        :                                                                  
.value       :                                                                  
.message     :Eg of debugging message added by a developer                      
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.190777000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22504                                                             
.traversal_id:383                                                               
.name        :l_unit_name                                                       
.value       :X                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.191819000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22506                                                             
.traversal_id:383                                                               
.name        :l_unit.unit_name                                                  
.value       :X                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.192725000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22508                                                             
.traversal_id:383                                                               
.name        :l_unit.unit_id                                                    
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.193416000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22510                                                             
.traversal_id:383                                                               
.name        :l_unit.unit_name                                                  
.value       :X                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.194220000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22512                                                             
.traversal_id:383                                                               
.name        :l_unit.unit_type                                                  
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.195410000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22514                                                             
.traversal_id:383                                                               
.name        :l_unit.module_id                                                  
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.196045000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22516                                                             
.traversal_id:383                                                               
.name        :l_unit.msg_mode                                                   
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.196654000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22518                                                             
.traversal_id:383                                                               
.name        :l_unit.open_process                                               
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.197326000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22520                                                             
.traversal_id:383                                                               
.name        :                                                                  
.value       :                                                                  
.message     :anon block1                                                       
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.198028000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22522                                                             
.traversal_id:383                                                               
.name        :x                                                                 
.value       :2                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.198944000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22524                                                             
.traversal_id:383                                                               
.name        :x                                                                 
.value       :2                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.199786000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22526                                                             
.traversal_id:383                                                               
.name        :x                                                                 
.value       :2                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.200613000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22528                                                             
.traversal_id:383                                                               
.name        :f#                                                                
.value       :3                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.201437000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22530                                                             
.traversal_id:383                                                               
.name        :g$                                                                
.value       :4                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.202277000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22532                                                             
.traversal_id:383                                                               
.name        :                                                                  
.value       :                                                                  
.message     :anon block2                                                       
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.203146000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :testz                                                            
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :testz                                                            
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
!Create a new unit                                                              
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:testz                                                   
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:testz                                                    
.current call_stack_level:11                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :3                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :testz                                                      
.i_parent_index     :3                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :testz                                                      
.traversal_id       :384                                                        
.unit_id            :44                                                         
.parent_traversal_id:383                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:testz                                                   
.l_next_index:4                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:testz                                                    
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:testz                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22534                                                             
.traversal_id:384                                                               
.name        :i_paramz                                                          
.value       :Z                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.207427000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:testz                                                    
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:testz                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22536                                                             
.traversal_id:384                                                               
.name        :l_var                                                             
.value       :                                                                  
.message     :
with event_details as (
select q.*
                              
,decode(:i_dataset_grp,NULL,'Dataset '||to_char(dataset_grp),'Assigned Group    
'||assigned_grp) context
from (
     select v.*
           ,max(event_date) over
(partition by new_linkage_key ) max_event_date
     from  ppms_event_v v
       
where dataset_grp = NVL(:i_dataset_grp,dataset_grp)
     and   publish_type in  
('GRY','STR')
     ) q
where max_event_date >= :i_min_qa_date
)
,               
personal_details_filter as (
    select    new_linkage_key
    from             
event_details e
    group by new_linkage_key
    having count(distinct          
trim_first_given) > 1
    and    count(distinct trim_first_given) =             
count(distinct trim_surname)
    and    count(distinct trim_first_given) =      
count(distinct trim_first_given||trim_surname)
    union all
    select         
new_linkage_key
    from      event_details e
    group by new_linkage_key
     
having count(distinct trim_first_given) > 1
    and    count(distinct           
trim_first_given) = count(distinct birth_date_char)
    and    count(distinct   
trim_first_given) = count(distinct trim_first_given||birth_date_char)
    union 
all
    select    new_linkage_key
    from      event_details e
    group by    
new_linkage_key
    having count(distinct trim_surname) > 1
    and             
count(distinct trim_surname) = count(distinct birth_date_char)
    and          
count(distinct trim_surname) = count(distinct trim_surname||birth_date_char)
   
union all
    select    new_linkage_key
    from      event_details e
    group 
by new_linkage_key
    having count(distinct trim_postcode) > 1
    and         
count(distinct trim_postcode) = count(distinct birth_date_char)
    and         
count(distinct trim_postcode) = count(distinct trim_postcode||birth_date_char)
 
union all
    select    new_linkage_key
    from      event_details e
    group 
by new_linkage_key
    having count(distinct trim_surname) > 1
    and          
count(distinct trim_surname) = count(distinct trim_postcode)
    and            
count(distinct trim_surname) = count(distinct trim_surname||trim_postcode)
)
   
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.208299000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:testz                                                    
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:testz                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22538                                                             
.traversal_id:384                                                               
.name        :                                                                  
.value       :                                                                  
.message     :testz is nested in anon block2                                    
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.213640000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:10                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:testz                                          
.last call_stack_level:11                                                       
!pop_descendent_nodes: removing top node 4                                      
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22540                                                             
.traversal_id:383                                                               
.name        :                                                                  
.value       :                                                                  
.message     :nested anon block3                                                
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.215549000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1                                                    
.current call_stack_level:9                                                     
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
.last call_stack_level:10                                                       
!pop_descendent_nodes: removing top node 3                                      
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22542                                                             
.traversal_id:382                                                               
.name        :i_param11                                                         
.value       :A                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.216675000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test1                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22544                                                             
.traversal_id:382                                                               
.name        :i_param12                                                         
.value       :B                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.217747000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test1                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22546                                                             
.traversal_id:382                                                               
.name        :i_param13                                                         
.value       :C                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.219111000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test1a                                                           
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test1a                                                           
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
!Create a new unit                                                              
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test1a                                                  
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test1                                          
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :2                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test1a                                                     
.i_parent_index     :2                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test1a                                                     
.traversal_id       :385                                                        
.unit_id            :45                                                         
.parent_traversal_id:382                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test1a                                                  
.l_next_index:3                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22548                                                             
.traversal_id:385                                                               
.name        :i_param1a1                                                        
.value       :A                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.222943000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22550                                                             
.traversal_id:385                                                               
.name        :                                                                  
.value       :                                                                  
.message     :anon block                                                        
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.223740000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test1aa                                                          
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test1aa                                                          
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
!Create a new unit                                                              
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test1aa                                                 
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :3                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test1aa                                                    
.i_parent_index     :3                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test1aa                                                    
.traversal_id       :386                                                        
.unit_id            :46                                                         
.parent_traversal_id:385                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test1aa                                                 
.l_next_index:4                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22552                                                             
.traversal_id:386                                                               
.name        :i_param1aa1                                                       
.value       :A                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.227489000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22554                                                             
.traversal_id:386                                                               
.name        :i_param1aa2                                                       
.value       :DUMMY                                                             
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.228381000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22556                                                             
.traversal_id:386                                                               
.name        :i_clob                                                            
.value       :ZZZZZ                                                             
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.229154000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22558                                                             
.traversal_id:386                                                               
.name        :                                                                  
.value       :                                                                  
.message     :Should see this comment a 3 times                                 
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.229872000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test1a                                                           
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test1a                                                           
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test1a                                                  
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
.last call_stack_level:11                                                       
.last call_stack_hist:0x95277538:306
0x9514d788:16
                             
!pop_to_parent_node: removing top node 4                                        
.last call_stack_level:10                                                       
.last call_stack_hist:0x9514d788:16
                                            
!pop_to_parent_node: removing top node 3                                        
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :2                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test1a                                                     
.i_parent_index     :2                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test1a                                                     
.traversal_id       :387                                                        
.unit_id            :45                                                         
.parent_traversal_id:382                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test1a                                                  
.l_next_index:3                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22560                                                             
.traversal_id:387                                                               
.name        :i_param1a1                                                        
.value       :B                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.232397000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22562                                                             
.traversal_id:387                                                               
.name        :                                                                  
.value       :                                                                  
.message     :anon block                                                        
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.233216000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test1aa                                                          
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test1aa                                                          
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test1aa                                                 
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :3                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test1aa                                                    
.i_parent_index     :3                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test1aa                                                    
.traversal_id       :388                                                        
.unit_id            :46                                                         
.parent_traversal_id:387                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test1aa                                                 
.l_next_index:4                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22564                                                             
.traversal_id:388                                                               
.name        :i_param1aa1                                                       
.value       :B                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.236590000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22566                                                             
.traversal_id:388                                                               
.name        :i_param1aa2                                                       
.value       :DUMMY                                                             
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.237279000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22568                                                             
.traversal_id:388                                                               
.name        :i_clob                                                            
.value       :ZZZZZ                                                             
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.238018000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22570                                                             
.traversal_id:388                                                               
.name        :                                                                  
.value       :                                                                  
.message     :Should see this comment a 3 times                                 
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.238744000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test1a                                                           
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test1a                                                           
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test1a                                                  
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
.last call_stack_level:11                                                       
.last call_stack_hist:0x95277538:308
0x9514d788:16
                             
!pop_to_parent_node: removing top node 4                                        
.last call_stack_level:10                                                       
.last call_stack_hist:0x9514d788:16
                                            
!pop_to_parent_node: removing top node 3                                        
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :2                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test1a                                                     
.i_parent_index     :2                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test1a                                                     
.traversal_id       :389                                                        
.unit_id            :45                                                         
.parent_traversal_id:382                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test1a                                                  
.l_next_index:3                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22572                                                             
.traversal_id:389                                                               
.name        :i_param1a1                                                        
.value       :C                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.241189000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1a                                                   
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22574                                                             
.traversal_id:389                                                               
.name        :                                                                  
.value       :                                                                  
.message     :anon block                                                        
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.241725000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test1aa                                                          
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test1aa                                                          
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test1aa                                                 
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:test1a                                         
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :3                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test1aa                                                    
.i_parent_index     :3                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test1aa                                                    
.traversal_id       :390                                                        
.unit_id            :46                                                         
.parent_traversal_id:389                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test1aa                                                 
.l_next_index:4                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22576                                                             
.traversal_id:390                                                               
.name        :i_param1aa1                                                       
.value       :C                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.245087000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22578                                                             
.traversal_id:390                                                               
.name        :i_param1aa2                                                       
.value       :DUMMY                                                             
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.245665000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22580                                                             
.traversal_id:390                                                               
.name        :i_clob                                                            
.value       :ZZZZZ                                                             
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.246200000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test1aa                                                  
.current call_stack_level:11                                                    
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22582                                                             
.traversal_id:390                                                               
.name        :                                                                  
.value       :                                                                  
.message     :Should see this comment a 3 times                                 
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.246705000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test2                                                            
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test2                                                            
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
!Create a new unit                                                              
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test2                                                   
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:4                                                                      
.g_nodes(f_index).unit.unit_name:test1aa                                        
.last call_stack_level:11                                                       
.last call_stack_hist:0x95277538:310
0x9514d788:16
                             
!pop_to_parent_node: removing top node 4                                        
.last call_stack_level:10                                                       
.last call_stack_hist:0x9514d788:16
                                            
!pop_to_parent_node: removing top node 3                                        
.last call_stack_level:9                                                        
.last call_stack_hist:                                                          
!pop_to_parent_node: removing top node 2                                        
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :1                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test2                                                      
.i_parent_index     :1                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test2                                                      
.traversal_id       :391                                                        
.unit_id            :47                                                         
.parent_traversal_id:381                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test2                                                   
.l_next_index:2                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22584                                                             
.traversal_id:391                                                               
.name        :i_param21                                                         
.value       :A                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.248781000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22586                                                             
.traversal_id:391                                                               
.name        :i_param22                                                         
.value       :B                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.249491000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22588                                                             
.traversal_id:391                                                               
.name        :io_param24                                                        
.value       :                                                                  
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.249946000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22590                                                             
.traversal_id:391                                                               
.name        :i_param25                                                         
.value       :C                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.250468000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22592                                                             
.traversal_id:391                                                               
.name        :l_clob_a                                                          
.value       :TEST                                                              
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.251214000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22594                                                             
.traversal_id:391                                                               
.name        :                                                                  
.value       :                                                                  
.message     :About to raise an error                                           
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.251752000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: dump_nodes                                                               
.i_index           :2                                                           
.i_msg_mode        :1                                                           
ENDED: dump_nodes                                                               
BEGAN: log_message                                                              
.l_message.msg_level:4                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22596                                                             
.traversal_id:391                                                               
.name        :                                                                  
.value       :                                                                  
.message     :ORA-01403: no data found
ORA-06512: at "A171872B.AOP_TEST", line  
345
                                                                            
.msg_type    :Message                                                           
.msg_level   :4                                                                 
.time_now    :28-APR-17 10.45.03.253080000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22598                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :340                                                               
.message     :  begin                                                           
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.254234000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22600                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :341                                                               
.message     :    l_clob_a := 'TEST';                                           
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.255207000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22602                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :342                                                               
.message     :    ms_logger.note_clob(l_node,'l_clob_a',l_clob_a);              
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.255914000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22604                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :343                                                               
.message     :    null;                                                         
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.256550000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22606                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :344                                                               
.message     :    ms_logger.comment(l_node,'About to raise an error');          
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.257201000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:3                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22608                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :345                                                               
.message     :    raise no_data_found;                                          
.msg_type    :Message                                                           
.msg_level   :3                                                                 
.time_now    :28-APR-17 10.45.03.257911000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22610                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :346                                                               
.message     :    ms_logger.fatal(l_node,'Should not have reached here.');      
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.258548000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22612                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :347                                                               
.message     :                                                                  
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.259206000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22614                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :348                                                               
.message     :                                                                  
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.259719000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22616                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :349                                                               
.message     :    ms_logger.comment(l_node,'This is a special comment');        
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.260277000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test2                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22618                                                             
.traversal_id:391                                                               
.name        :LINE NO                                                           
.value       :350                                                               
.message     :    ms_logger.info(l_node,'This is a special info');              
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.260877000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :test3                                                            
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :test3                                                            
.i_unit_type  :FUNC                                                             
.i_create  :TRUE                                                                
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:test3                                                   
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test2                                          
.last call_stack_level:9                                                        
.last call_stack_hist:                                                          
!pop_to_parent_node: removing top node 2                                        
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :1                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :test3                                                      
.i_parent_index     :1                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :test3                                                      
.traversal_id       :392                                                        
.unit_id            :43                                                         
.parent_traversal_id:381                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:test3                                                   
.l_next_index:2                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22620                                                             
.traversal_id:392                                                               
.name        :i_param31                                                         
.value       :A                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.262663000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22622                                                             
.traversal_id:392                                                               
.name        :                                                                  
.value       :                                                                  
.message     :Eg of debugging message added by a developer                      
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.263531000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22624                                                             
.traversal_id:392                                                               
.name        :l_unit_name                                                       
.value       :X                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.264157000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22626                                                             
.traversal_id:392                                                               
.name        :l_unit.unit_name                                                  
.value       :X                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.264791000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22628                                                             
.traversal_id:392                                                               
.name        :l_unit.unit_id                                                    
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.265283000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22630                                                             
.traversal_id:392                                                               
.name        :l_unit.unit_name                                                  
.value       :X                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.265791000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22632                                                             
.traversal_id:392                                                               
.name        :l_unit.unit_type                                                  
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.266282000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22634                                                             
.traversal_id:392                                                               
.name        :l_unit.module_id                                                  
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.266684000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22636                                                             
.traversal_id:392                                                               
.name        :l_unit.msg_mode                                                   
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.268156000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22638                                                             
.traversal_id:392                                                               
.name        :l_unit.open_process                                               
.value       :                                                                  
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.268837000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22640                                                             
.traversal_id:392                                                               
.name        :                                                                  
.value       :                                                                  
.message     :anon block1                                                       
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.269515000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22642                                                             
.traversal_id:392                                                               
.name        :x                                                                 
.value       :2                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.270444000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22644                                                             
.traversal_id:392                                                               
.name        :x                                                                 
.value       :2                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.271664000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22646                                                             
.traversal_id:392                                                               
.name        :x                                                                 
.value       :2                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.272498000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22648                                                             
.traversal_id:392                                                               
.name        :f#                                                                
.value       :3                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.273322000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22650                                                             
.traversal_id:392                                                               
.name        :g$                                                                
.value       :4                                                                 
.message     :                                                                  
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.274161000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22652                                                             
.traversal_id:392                                                               
.name        :                                                                  
.value       :                                                                  
.message     :anon block2                                                       
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.275014000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: find_module                                                              
.i_module_name:aop_test                                                         
.i_module_type:                                                                 
.i_revision   :                                                                 
.i_unit_name  :testz                                                            
.i_create  :TRUE                                                                
ENDED: find_module                                                              
BEGAN: find_unit                                                                
.i_module_id  :2                                                                
.i_unit_name  :testz                                                            
.i_unit_type  :PROC                                                             
.i_create  :TRUE                                                                
ENDED: find_unit                                                                
BEGAN: create_traversal                                                         
.io_node.unit.unit_name:testz                                                   
BEGAN: pop_to_parent_node                                                       
.i_node.unit.unit_name:testz                                                    
.current call_stack_level:10                                                    
.f_index:2                                                                      
.g_nodes(f_index).unit.unit_name:test3                                          
ENDED: pop_to_parent_node                                                       
BEGAN: dump_nodes                                                               
.i_index           :2                                                           
.i_msg_mode        :4                                                           
ENDED: dump_nodes                                                               
BEGAN: log_node                                                                 
.unit_name          :testz                                                      
.i_parent_index     :2                                                          
!Log a node first time                                                          
.module_name        :aop_test                                                   
.unit_name          :testz                                                      
.traversal_id       :393                                                        
.unit_id            :44                                                         
.parent_traversal_id:392                                                        
.process_id         :5                                                          
.msg_mode           :1                                                          
ENDED: log_node                                                                 
BEGAN: push_node                                                                
.io_node.unit.unit_name:testz                                                   
.l_next_index:3                                                                 
ENDED: push_node                                                                
ENDED: create_traversal                                                         
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:testz                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:testz                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22654                                                             
.traversal_id:393                                                               
.name        :i_paramz                                                          
.value       :Z                                                                 
.message     :                                                                  
.msg_type    :Param                                                             
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.277934000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:testz                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:testz                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22656                                                             
.traversal_id:393                                                               
.name        :l_var                                                             
.value       :                                                                  
.message     :
with event_details as (
select q.*
                              
,decode(:i_dataset_grp,NULL,'Dataset '||to_char(dataset_grp),'Assigned Group    
'||assigned_grp) context
from (
     select v.*
           ,max(event_date) over
(partition by new_linkage_key ) max_event_date
     from  ppms_event_v v
       
where dataset_grp = NVL(:i_dataset_grp,dataset_grp)
     and   publish_type in  
('GRY','STR')
     ) q
where max_event_date >= :i_min_qa_date
)
,               
personal_details_filter as (
    select    new_linkage_key
    from             
event_details e
    group by new_linkage_key
    having count(distinct          
trim_first_given) > 1
    and    count(distinct trim_first_given) =             
count(distinct trim_surname)
    and    count(distinct trim_first_given) =      
count(distinct trim_first_given||trim_surname)
    union all
    select         
new_linkage_key
    from      event_details e
    group by new_linkage_key
     
having count(distinct trim_first_given) > 1
    and    count(distinct           
trim_first_given) = count(distinct birth_date_char)
    and    count(distinct   
trim_first_given) = count(distinct trim_first_given||birth_date_char)
    union 
all
    select    new_linkage_key
    from      event_details e
    group by    
new_linkage_key
    having count(distinct trim_surname) > 1
    and             
count(distinct trim_surname) = count(distinct birth_date_char)
    and          
count(distinct trim_surname) = count(distinct trim_surname||birth_date_char)
   
union all
    select    new_linkage_key
    from      event_details e
    group 
by new_linkage_key
    having count(distinct trim_postcode) > 1
    and         
count(distinct trim_postcode) = count(distinct birth_date_char)
    and         
count(distinct trim_postcode) = count(distinct trim_postcode||birth_date_char)
 
union all
    select    new_linkage_key
    from      event_details e
    group 
by new_linkage_key
    having count(distinct trim_surname) > 1
    and          
count(distinct trim_surname) = count(distinct trim_postcode)
    and            
count(distinct trim_surname) = count(distinct trim_surname||trim_postcode)
)
   
.msg_type    :Note                                                              
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.278726000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
ENDED: create_ref                                                               
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:testz                                                    
.current call_stack_level:10                                                    
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:testz                                          
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22658                                                             
.traversal_id:393                                                               
.name        :                                                                  
.value       :                                                                  
.message     :testz is nested in anon block2                                    
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.279986000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           
BEGAN: create_message                                                           
BEGAN: pop_descendent_nodes                                                     
.i_node.unit.unit_name:test3                                                    
.current call_stack_level:9                                                     
.f_index:3                                                                      
.g_nodes(f_index).unit.unit_name:testz                                          
.last call_stack_level:10                                                       
!pop_descendent_nodes: removing top node 3                                      
ENDED: pop_descendent_nodes                                                     
BEGAN: log_message                                                              
.l_message.msg_level:1                                                          
.i_node.traversal.msg_mode:1                                                    
!Loggable, so log it.                                                           
.message_id  :22660                                                             
.traversal_id:392                                                               
.name        :                                                                  
.value       :                                                                  
.message     :nested anon block3                                                
.msg_type    :Message                                                           
.msg_level   :1                                                                 
.time_now    :28-APR-17 10.45.03.280746000 PM                                   
ENDED: log_message                                                              
ENDED: create_message                                                           

PL/SQL procedure successfully completed.

